generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id        Int     @id @default(autoincrement())
  firstName String
  lastName  String
  email     String
  phone     String
  storeId   Int     @default(1)
  orders    Order[]
}

model Order {
  id                    Int                     @id @default(autoincrement())
  customerId            Int
  totalPrice            Float
  createdAt             DateTime                @default(now())
  notes                 String?
  storeId               Int
  paymentStatus         PaymentStatus           @default(PENDING)
  paymentLinkId         String?
  updatedAt             DateTime?               @updatedAt
  canceledAt            DateTime?
  status                OrderStatus             @default(ACTIVE)
  labelPurchased        Boolean                 @default(false)
  isPickup              Boolean                 @default(false)
  deleteQueuedAt        DateTime?
  customer              Customer                @relation(fields: [customerId], references: [id])
  items                 OrderItem[]
  shippingLabels        ShippingLabel[]
  ShippingRateSelection ShippingRateSelection[]
}

model OrderItem {
  id           Int        @id @default(autoincrement())
  orderId      Int
  productId    Int
  quantity     Int
  size         String
  isAddBack    Boolean?   @default(false)
  category     Categories @default(TSHIRTS)
  color        String     @default("black")
  price        Float      @default(20.00)
  title        String     @default("Retro")
  notes        String?
  playerName   String?
  playerNumber String?
  productImage String?
  material     String     @default("cotton")
  order        Order      @relation(fields: [orderId], references: [id])
}

model ShippingLabel {
  id                  String       @id @default(uuid())
  orderId             Int
  rateId              String
  labelUrl            String
  trackingNumber      String
  createdAt           DateTime     @default(now())
  refunded            Boolean      @default(false)
  shippoTransactionId String?
  refundStatus        RefundStatus @default(PENDING)
  refundedAt          DateTime?
  order               Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model ShippingRateSelection {
  id        String   @id
  orderId   Int
  rateId    String
  createdAt DateTime @default(now())
  Order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

enum Categories {
  TSHIRTS
  HOODIES
  LONG_SLEEVE
  BOTTOMS
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

enum OrderStatus {
  ACTIVE
  CANCEL_REQUESTED
  CANCELED
}

enum RefundStatus {
  PENDING
  QUEUED
  SUCCESS
  FAILED
  NOT_REQUESTED
}
